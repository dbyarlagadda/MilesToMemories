<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#faf8f5">
    <title>MilesToMemories | A Travel Diary</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --sky-blue: #a8ccd7;
            --sky-blue-light: #d4e8ed;
            --sandy-beige: #e8dcc4;
            --sandy-beige-light: #f5f0e6;
            --forest-green: #4a6741;
            --forest-green-light: #7a9a6d;
            --warm-neutral: #c9b99a;
            --warm-cream: #faf8f5;
            --soft-gray: #6b6b6b;
            --dark-text: #2d2d2d;
            --white: #ffffff;
            --like-red: #e25555;

            --font-serif: 'Cormorant Garamond', Georgia, serif;
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
            --spacing-xxl: 4rem;

            --transition-slow: 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-medium: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: 0.15s ease;

            --nav-height: 60px;
            --bottom-nav-height: 70px;
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: var(--font-sans);
            font-weight: 300;
            color: var(--dark-text);
            background-color: var(--warm-cream);
            line-height: 1.7;
            overflow-x: hidden;
            padding-bottom: calc(var(--bottom-nav-height) + var(--safe-bottom));
        }

        body.modal-open {
            overflow: hidden;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        h1, h2, h3, h4 {
            font-family: var(--font-serif);
            font-weight: 500;
            line-height: 1.2;
        }

        h1 { font-size: clamp(2rem, 8vw, 4rem); }
        h2 { font-size: clamp(1.75rem, 5vw, 2.75rem); }
        h3 { font-size: clamp(1.25rem, 4vw, 1.75rem); }

        p {
            font-size: 1rem;
            max-width: 65ch;
            color: var(--soft-gray);
        }

        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: calc(var(--nav-height) + var(--safe-top));
            padding: var(--safe-top) var(--spacing-md) 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--white);
            box-shadow: 0 1px 10px rgba(0, 0, 0, 0.05);
            transition: var(--transition-medium);
        }

        .nav-logo {
            font-family: var(--font-serif);
            font-size: 1.25rem;
            font-weight: 500;
            color: var(--dark-text);
            text-decoration: none;
        }

        .nav-links {
            display: none;
            gap: var(--spacing-lg);
            list-style: none;
        }

        .nav-links a {
            font-size: 0.8rem;
            color: var(--soft-gray);
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .nav-toggle {
            display: flex;
            flex-direction: column;
            gap: 5px;
            width: 44px;
            height: 44px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            justify-content: center;
        }

        .nav-toggle span {
            width: 22px;
            height: 2px;
            background: var(--dark-text);
            transition: var(--transition-fast);
        }

        /* Mobile Menu */
        .mobile-menu {
            position: fixed;
            inset: 0;
            z-index: 2000;
            background: var(--warm-cream);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-lg);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-medium);
        }

        .mobile-menu.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu a {
            font-family: var(--font-serif);
            font-size: 2rem;
            color: var(--dark-text);
            text-decoration: none;
            padding: var(--spacing-sm);
        }

        .mobile-menu-close {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            width: 44px;
            height: 44px;
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--dark-text);
            cursor: pointer;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: calc(var(--bottom-nav-height) + var(--safe-bottom));
            padding-bottom: var(--safe-bottom);
            background: var(--white);
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.05);
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            background: none;
            border: none;
            color: var(--soft-gray);
            text-decoration: none;
            font-size: 0.65rem;
            font-weight: 500;
            text-transform: uppercase;
            cursor: pointer;
        }

        .bottom-nav-item.active { color: var(--forest-green); }

        .bottom-nav-icon { font-size: 1.5rem; }

        .bottom-nav-add {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--forest-green);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            margin-top: -25px;
            box-shadow: 0 4px 15px rgba(74, 103, 65, 0.3);
        }

        /* Hero */
        .hero {
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            padding: var(--spacing-lg);
        }

        .hero-bg {
            position: absolute;
            inset: 0;
            z-index: -1;
        }

        .hero-bg img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            animation: fadeIn 1s ease forwards;
        }

        .hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.5));
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 600px;
            opacity: 0;
            transform: translateY(20px);
            animation: slideUp 0.8s ease 0.3s forwards;
        }

        .hero-subtitle {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.25em;
            color: var(--sandy-beige);
            margin-bottom: var(--spacing-md);
        }

        .hero h1 {
            color: var(--white);
            margin-bottom: var(--spacing-md);
        }

        .hero-description {
            font-family: var(--font-serif);
            font-size: 1.125rem;
            font-style: italic;
            color: rgba(255, 255, 255, 0.9);
        }

        .scroll-indicator {
            position: absolute;
            bottom: calc(var(--bottom-nav-height) + var(--safe-bottom) + 20px);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: var(--white);
            opacity: 0;
            animation: fadeIn 1s ease 1s forwards;
        }

        .scroll-indicator span {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .scroll-indicator .arrow {
            width: 1px;
            height: 40px;
            background: linear-gradient(to bottom, var(--white), transparent);
        }

        /* Sections */
        .section {
            padding: var(--spacing-xxl) var(--spacing-md);
        }

        .section-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .section-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.25em;
            color: var(--forest-green);
            margin-bottom: var(--spacing-xs);
        }

        /* Introduction */
        .intro {
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
        }

        .intro h2 {
            color: var(--forest-green);
            margin-bottom: var(--spacing-md);
        }

        .intro p { margin: 0 auto var(--spacing-md); }

        .intro-divider {
            width: 50px;
            height: 1px;
            background: var(--warm-neutral);
            margin: var(--spacing-lg) auto;
        }

        /* Story Cards */
        .stories { background: var(--white); }

        .stories-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-lg);
            max-width: 1200px;
            margin: 0 auto;
        }

        .story-card {
            background: var(--warm-cream);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            opacity: 0;
            transform: translateY(30px);
            transition: var(--transition-slow);
        }

        .story-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .story-card-image {
            aspect-ratio: 4/3;
            overflow: hidden;
            position: relative;
        }

        .story-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-slow);
        }

        .story-card:active .story-card-image img {
            transform: scale(1.03);
        }

        .story-card-content {
            padding: var(--spacing-md);
        }

        .story-card-location {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--forest-green);
            margin-bottom: 4px;
        }

        .story-card h3 {
            margin-bottom: 4px;
            color: var(--dark-text);
        }

        .story-card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .story-card-date {
            font-size: 0.85rem;
            color: var(--soft-gray);
        }

        .story-card-stats {
            display: flex;
            gap: 12px;
            font-size: 0.8rem;
            color: var(--soft-gray);
        }

        .story-card-stats span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Trip Detail Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 3000;
            background: rgba(0, 0, 0, 0.6);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-medium);
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .trip-modal {
            width: 100%;
            max-height: 95vh;
            background: var(--white);
            border-radius: 20px 20px 0 0;
            transform: translateY(100%);
            transition: transform var(--transition-medium);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.active .trip-modal {
            transform: translateY(0);
        }

        .modal-handle {
            width: 40px;
            height: 4px;
            background: var(--sandy-beige);
            border-radius: 2px;
            margin: 12px auto;
            flex-shrink: 0;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--spacing-md) var(--spacing-sm);
            border-bottom: 1px solid var(--sandy-beige-light);
            flex-shrink: 0;
        }

        .modal-title {
            font-family: var(--font-serif);
            font-size: 1.25rem;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--sandy-beige-light);
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .trip-image-container {
            position: relative;
            aspect-ratio: 4/3;
        }

        .trip-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .trip-gallery-dots {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
        }

        .gallery-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
        }

        .gallery-dot.active {
            background: var(--white);
        }

        /* Trip Actions */
        .trip-actions {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--sandy-beige-light);
        }

        .trip-actions-left,
        .trip-actions-right {
            display: flex;
            gap: 16px;
        }

        .action-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 4px;
            color: var(--dark-text);
            transition: var(--transition-fast);
        }

        .action-btn:active {
            transform: scale(0.9);
        }

        .action-btn.liked {
            color: var(--like-red);
        }

        .action-btn.saved {
            color: var(--forest-green);
        }

        /* Trip Info */
        .trip-info {
            padding: var(--spacing-md);
        }

        .trip-likes {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .trip-location {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: var(--forest-green);
            margin-bottom: var(--spacing-xs);
        }

        .trip-date {
            font-size: 0.8rem;
            color: var(--soft-gray);
            margin-bottom: var(--spacing-md);
        }

        .trip-description {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--dark-text);
            margin-bottom: var(--spacing-md);
        }

        .trip-mood {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--sandy-beige-light);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--soft-gray);
            margin-bottom: var(--spacing-md);
        }

        /* Comments Section */
        .comments-section {
            padding: var(--spacing-md);
            background: var(--sandy-beige-light);
        }

        .comments-header {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: var(--spacing-md);
        }

        .comment {
            display: flex;
            gap: 12px;
            margin-bottom: var(--spacing-md);
        }

        .comment-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-author {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .comment-text {
            font-size: 0.9rem;
            color: var(--dark-text);
            line-height: 1.5;
        }

        .comment-time {
            font-size: 0.75rem;
            color: var(--soft-gray);
            margin-top: 4px;
        }

        .comment-like {
            background: none;
            border: none;
            color: var(--soft-gray);
            cursor: pointer;
            padding: 8px;
            font-size: 1rem;
        }

        /* Add Comment */
        .add-comment {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: var(--spacing-md);
            background: var(--white);
            border-top: 1px solid var(--sandy-beige-light);
            position: sticky;
            bottom: 0;
        }

        .add-comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .add-comment-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid var(--sandy-beige);
            border-radius: 20px;
            font-size: 0.9rem;
            outline: none;
            background: var(--sandy-beige-light);
        }

        .add-comment-input:focus {
            border-color: var(--forest-green);
            background: var(--white);
        }

        .add-comment-btn {
            background: none;
            border: none;
            color: var(--forest-green);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            padding: 8px;
            opacity: 0.5;
        }

        .add-comment-btn.active {
            opacity: 1;
        }

        /* Featured Story */
        .featured {
            background: var(--sandy-beige-light);
            padding: 0;
        }

        .featured-container {
            display: flex;
            flex-direction: column;
        }

        .featured-image {
            aspect-ratio: 4/3;
            overflow: hidden;
            cursor: pointer;
        }

        .featured-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-slow);
        }

        .featured-image:active img {
            transform: scale(1.02);
        }

        .featured-content {
            padding: var(--spacing-xl) var(--spacing-md);
        }

        .featured-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.25em;
            color: var(--forest-green);
            margin-bottom: var(--spacing-sm);
        }

        .featured h2 {
            margin-bottom: var(--spacing-md);
        }

        .featured-excerpt {
            font-family: var(--font-serif);
            font-size: 1.1rem;
            font-style: italic;
            color: var(--soft-gray);
            margin-bottom: var(--spacing-lg);
            line-height: 1.8;
        }

        .read-more {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--forest-green);
            text-decoration: none;
            padding: 12px 0;
            cursor: pointer;
        }

        .read-more::after { content: 'â†’'; }

        /* Gallery */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .gallery-item {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            border-radius: 8px;
            cursor: pointer;
        }

        .gallery-item:first-child {
            grid-column: span 2;
            aspect-ratio: 16/9;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.6), transparent 60%);
            display: flex;
            align-items: flex-end;
            padding: var(--spacing-sm);
        }

        .gallery-item-caption {
            color: var(--white);
            font-family: var(--font-serif);
            font-size: 0.9rem;
            font-style: italic;
        }

        /* Quote */
        .quote-section {
            background: var(--forest-green);
            text-align: center;
        }

        .quote {
            max-width: 600px;
            margin: 0 auto;
        }

        .quote blockquote {
            font-family: var(--font-serif);
            font-size: clamp(1.25rem, 4vw, 1.75rem);
            font-style: italic;
            color: var(--white);
            line-height: 1.6;
            margin-bottom: var(--spacing-md);
        }

        .quote cite {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--sandy-beige);
        }

        /* Destinations */
        .destinations-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            max-width: 800px;
            margin: 0 auto;
        }

        .destination-tag {
            padding: 10px 18px;
            border: 1px solid var(--warm-neutral);
            border-radius: 50px;
            font-size: 0.85rem;
            color: var(--soft-gray);
            text-decoration: none;
            transition: var(--transition-fast);
            background: var(--white);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .destination-tag:active {
            background: var(--forest-green);
            border-color: var(--forest-green);
            color: var(--white);
            transform: scale(0.95);
        }

        @media (min-width: 768px) {
            .destination-tag:hover {
                background: var(--forest-green);
                border-color: var(--forest-green);
                color: var(--white);
            }
        }

        /* Newsletter */
        .newsletter {
            background: var(--sky-blue-light);
            text-align: center;
        }

        .newsletter-content {
            max-width: 500px;
            margin: 0 auto;
        }

        .newsletter h2 { margin-bottom: var(--spacing-xs); }
        .newsletter p {
            margin: 0 auto var(--spacing-lg);
            font-size: 0.95rem;
        }

        .newsletter-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .newsletter-input {
            width: 100%;
            padding: 14px 18px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            background: var(--white);
        }

        .newsletter-input:focus {
            outline: 2px solid var(--forest-green);
        }

        .newsletter-btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: var(--forest-green);
            color: var(--white);
            cursor: pointer;
        }

        /* Footer */
        .footer {
            padding: var(--spacing-xl) var(--spacing-md);
            padding-bottom: calc(var(--spacing-xl) + var(--bottom-nav-height) + var(--safe-bottom));
            background: var(--dark-text);
            color: var(--white);
            text-align: center;
        }

        .footer-brand h3 {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-sm);
        }

        .footer-brand p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-bottom: var(--spacing-lg);
        }

        .footer-links-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-lg);
            text-align: left;
            margin-bottom: var(--spacing-lg);
        }

        .footer-links h4 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-bottom: var(--spacing-sm);
            color: var(--sandy-beige);
        }

        .footer-links ul { list-style: none; }
        .footer-links li { margin-bottom: 8px; }

        .footer-links a {
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .footer-social-icons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .footer-social-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, opacity 0.2s;
        }

        .footer-social-icon:hover {
            transform: scale(1.1);
            opacity: 0.9;
        }

        .footer-social-icon svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .footer-social-icon.instagram {
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
        }

        .footer-social-icon.pinterest {
            background: #BD081C;
        }

        .footer-social-icon.youtube {
            background: #FF0000;
        }

        .footer-connect-prompt {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
        }

        .footer-connect-prompt:hover {
            color: rgba(255, 255, 255, 0.9);
        }

        .footer-bottom {
            padding-top: var(--spacing-lg);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-bottom p {
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.8rem;
            margin: 0 auto;
        }

        /* Mobile User Menu */
        .mobile-menu-user {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--sandy-beige);
        }

        .mobile-user-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
        }

        .mobile-user-name {
            font-family: var(--font-serif);
            font-size: 1.25rem;
            color: var(--dark-text);
        }

        .mobile-signout {
            color: var(--like-red) !important;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--sandy-beige);
        }

        #navSignout a {
            color: var(--like-red);
        }

        #navSignout a:hover {
            color: #c44;
        }

        /* Edit Trip Modal */
        .edit-modal {
            width: 100%;
            max-height: 95vh;
            background: var(--white);
            border-radius: 20px 20px 0 0;
            transform: translateY(100%);
            transition: transform var(--transition-medium);
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.active .edit-modal {
            transform: translateY(0);
        }

        .edit-form {
            padding: var(--spacing-md);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            overflow-y: auto;
            flex: 1;
        }

        .edit-photo-preview {
            width: 100%;
            aspect-ratio: 4/3;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            background: var(--sandy-beige-light);
        }

        .edit-photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .edit-photo-btn {
            position: absolute;
            bottom: 12px;
            right: 12px;
            padding: 10px 16px;
            background: rgba(0,0,0,0.7);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .edit-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--sandy-beige);
            border-radius: 10px;
            font-family: var(--font-sans);
            font-size: 1rem;
            background: var(--sandy-beige-light);
        }

        .edit-input:focus {
            outline: none;
            border-color: var(--forest-green);
            background: var(--white);
        }

        .edit-textarea {
            min-height: 120px;
            resize: none;
        }

        .edit-label {
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--dark-text);
            margin-bottom: 6px;
        }

        .edit-actions {
            display: flex;
            gap: 12px;
            padding: var(--spacing-md);
            border-top: 1px solid var(--sandy-beige-light);
            background: var(--white);
        }

        .edit-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-family: var(--font-sans);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .edit-btn-cancel {
            background: var(--sandy-beige-light);
            color: var(--soft-gray);
        }

        .edit-btn-save {
            background: var(--forest-green);
            color: var(--white);
        }

        .edit-btn-delete {
            background: #fee;
            color: #c44;
        }

        @media (min-width: 768px) {
            .edit-modal {
                max-width: 500px;
                max-height: 90vh;
                border-radius: 20px;
                margin: auto;
            }

            .profile-dropdown {
                display: block;
            }
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: calc(var(--bottom-nav-height) + var(--safe-bottom) + 20px);
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--dark-text);
            color: var(--white);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.9rem;
            z-index: 4000;
            opacity: 0;
            transition: all var(--transition-medium);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Destination Modal */
        .destination-modal {
            width: 100%;
            height: 100%;
            max-height: 100vh;
            background: var(--warm-cream);
            transform: translateX(100%);
            transition: transform var(--transition-medium);
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.active .destination-modal {
            transform: translateX(0);
        }

        .destination-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--white);
            border-bottom: 1px solid var(--sandy-beige-light);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .destination-back {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--sandy-beige-light);
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .destination-title {
            flex: 1;
        }

        .destination-title h2 {
            font-size: 1.5rem;
            margin-bottom: 2px;
        }

        .destination-count {
            font-size: 0.85rem;
            color: var(--soft-gray);
        }

        .destination-body {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: var(--spacing-md);
        }

        .destination-hero {
            position: relative;
            aspect-ratio: 16/9;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: var(--spacing-lg);
        }

        .destination-hero img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .destination-hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.6), transparent);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: var(--spacing-md);
        }

        .destination-hero-title {
            color: var(--white);
            font-family: var(--font-serif);
            font-size: 1.75rem;
            margin-bottom: 4px;
        }

        .destination-hero-subtitle {
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
        }

        .destination-section-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--dark-text);
        }

        .destination-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .destination-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
        }

        .destination-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-medium);
        }

        .destination-item:active img {
            transform: scale(1.05);
        }

        .destination-item-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent 60%);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 12px;
        }

        .destination-item-title {
            color: var(--white);
            font-family: var(--font-serif);
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .destination-item-date {
            color: rgba(255,255,255,0.7);
            font-size: 0.75rem;
        }

        .destination-item-stats {
            display: flex;
            gap: 10px;
            margin-top: 6px;
        }

        .destination-item-stats span {
            color: rgba(255,255,255,0.8);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .no-trips {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--soft-gray);
        }

        .no-trips-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        @media (min-width: 768px) {
            .destination-modal {
                max-width: 600px;
                height: auto;
                max-height: 90vh;
                border-radius: 20px;
                margin: auto;
                transform: scale(0.9);
                opacity: 0;
            }

            .modal-overlay.active .destination-modal {
                transform: scale(1);
                opacity: 1;
            }

            .destination-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .destination-item:hover img {
                transform: scale(1.05);
            }
        }

        /* Map Timeline */
        .map-timeline-section {
            background: var(--dark-text);
            padding: var(--spacing-xxl) var(--spacing-md);
        }

        .map-timeline-section .section-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .map-timeline-section .section-label {
            color: var(--sandy-beige);
        }

        .map-timeline-section h2 {
            color: var(--white);
        }

        .map-timeline-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
            max-width: 1200px;
            margin: 0 auto;
        }

        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        #tripMap {
            width: 100%;
            height: 100%;
        }

        .timeline-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: var(--spacing-md);
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .timeline-title {
            font-family: var(--font-serif);
            font-size: 1.25rem;
            color: var(--white);
        }

        .timeline-filter {
            display: flex;
            gap: 8px;
        }

        .timeline-filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timeline-filter-btn.active,
        .timeline-filter-btn:hover {
            background: var(--forest-green);
            border-color: var(--forest-green);
            color: var(--white);
        }

        .timeline-scroll {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding-bottom: 12px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }

        .timeline-scroll::-webkit-scrollbar {
            height: 4px;
        }

        .timeline-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }

        .timeline-scroll::-webkit-scrollbar-thumb {
            background: var(--forest-green);
            border-radius: 2px;
        }

        .timeline-item {
            flex-shrink: 0;
            width: 200px;
            scroll-snap-align: start;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .timeline-item:hover {
            transform: translateY(-4px);
        }

        .timeline-item.active .timeline-image {
            border-color: var(--forest-green);
        }

        .timeline-image {
            width: 100%;
            aspect-ratio: 4/3;
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid transparent;
            transition: border-color 0.2s;
        }

        .timeline-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .timeline-info {
            padding: 12px 4px;
        }

        .timeline-date {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--forest-green-light);
            margin-bottom: 4px;
        }

        .timeline-location {
            font-size: 0.95rem;
            color: var(--white);
            font-weight: 500;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .timeline-title-small {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .map-marker-popup {
            text-align: center;
        }

        .map-marker-popup img {
            width: 150px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .map-marker-popup h4 {
            margin: 0 0 4px;
            font-size: 0.95rem;
        }

        .map-marker-popup p {
            margin: 0;
            font-size: 0.8rem;
            color: var(--soft-gray);
        }

        .leaflet-popup-content-wrapper {
            border-radius: 12px;
        }

        .leaflet-popup-content {
            margin: 12px;
        }

        @media (min-width: 768px) {
            .map-timeline-container {
                flex-direction: row;
            }

            .map-container {
                flex: 2;
                height: 500px;
            }

            .timeline-container {
                flex: 1;
                max-width: 350px;
            }

            .timeline-scroll {
                flex-direction: column;
                overflow-x: visible;
                overflow-y: auto;
                max-height: 420px;
            }

            .timeline-item {
                width: 100%;
            }
        }

        /* Animations */
        @keyframes fadeIn { to { opacity: 1; } }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }

        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Tablet and Desktop */
        @media (min-width: 768px) {
            :root {
                --spacing-md: 2rem;
                --spacing-lg: 3rem;
                --spacing-xl: 5rem;
                --spacing-xxl: 7rem;
            }

            body { padding-bottom: 0; }

            .nav-links { display: flex; }
            .nav-toggle, .bottom-nav { display: none; }

            .section { padding: var(--spacing-xxl) var(--spacing-lg); }

            .stories-grid { grid-template-columns: repeat(3, 1fr); }

            .story-card-image { aspect-ratio: 4/5; }

            .story-card:hover .story-card-image img {
                transform: scale(1.05);
            }

            .modal-overlay {
                align-items: center;
            }

            .trip-modal {
                max-width: 500px;
                max-height: 90vh;
                border-radius: 20px;
                margin: var(--spacing-md);
            }

            .featured-container {
                flex-direction: row;
                min-height: 70vh;
            }

            .featured-image, .featured-content {
                flex: 1;
            }

            .featured-image { aspect-ratio: auto; }

            .featured-content {
                display: flex;
                flex-direction: column;
                justify-content: center;
                padding: var(--spacing-xl);
                max-width: 550px;
            }

            .gallery-grid {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(2, 250px);
                gap: var(--spacing-md);
            }

            .gallery-item:first-child {
                grid-column: span 2;
                grid-row: span 2;
                aspect-ratio: auto;
            }

            .gallery-item { aspect-ratio: auto; }

            .gallery-item-overlay {
                opacity: 0;
                transition: opacity var(--transition-medium);
            }

            .gallery-item:hover .gallery-item-overlay { opacity: 1; }
            .gallery-item:hover img { transform: scale(1.05); }

            .newsletter-form { flex-direction: row; }
            .newsletter-input { flex: 1; }

            .footer {
                padding-bottom: var(--spacing-xl);
                text-align: left;
            }

            .footer-content {
                display: grid;
                grid-template-columns: 2fr 1fr 1.5fr;
                gap: var(--spacing-lg);
                max-width: 1000px;
                margin: 0 auto var(--spacing-xl);
            }

            .footer-brand { text-align: left; }
            .footer-brand p { margin-bottom: 0; }
            .footer-links-grid { display: contents; }

            .scroll-indicator { bottom: var(--spacing-lg); }
        }

        /* iPad and Larger Tablets */
        @media (min-width: 1024px) {
            .hero h1 {
                font-size: 4.5rem;
            }

            .stories-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: var(--spacing-xl);
            }

            .story-card-content {
                padding: var(--spacing-lg);
            }

            .gallery-grid {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(2, 300px);
            }

            .map-container {
                height: 600px;
            }

            .timeline-container {
                max-width: 400px;
            }

            .trip-modal {
                max-width: 600px;
            }

            .destination-modal {
                max-width: 700px;
            }
        }

        /* Large Desktop / iPad Pro Landscape */
        @media (min-width: 1366px) {
            :root {
                --spacing-xxl: 8rem;
            }

            .hero h1 {
                font-size: 5rem;
            }

            .stories-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .gallery-grid {
                grid-template-columns: repeat(5, 1fr);
                grid-template-rows: repeat(2, 280px);
            }

            .gallery-item:first-child {
                grid-column: span 2;
                grid-row: span 2;
            }

            .map-timeline-container {
                gap: var(--spacing-xl);
            }

            .map-container {
                height: 650px;
            }

            .featured-content {
                padding: var(--spacing-xxl);
            }
        }

        /* Extra Large Screens */
        @media (min-width: 1920px) {
            .stories-grid,
            .gallery-grid,
            .map-timeline-container {
                max-width: 1600px;
            }

            .hero h1 {
                font-size: 6rem;
            }
        }

        /* iPad Portrait Specific */
        @media (min-width: 768px) and (max-width: 1024px) and (orientation: portrait) {
            .stories-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .gallery-grid {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(3, 200px);
            }

            .gallery-item:first-child {
                grid-column: span 2;
                grid-row: span 2;
            }

            .map-timeline-container {
                flex-direction: column;
            }

            .timeline-container {
                max-width: 100%;
            }

            .timeline-scroll {
                flex-direction: row;
                overflow-x: auto;
                overflow-y: visible;
                max-height: none;
            }

            .timeline-item {
                width: 200px;
            }
        }

        /* Landscape Mode Adjustments */
        @media (orientation: landscape) and (max-height: 500px) {
            .hero {
                min-height: 100vh;
                padding: var(--spacing-md);
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .scroll-indicator {
                display: none;
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .story-card:hover .story-card-image img,
            .gallery-item:hover img,
            .destination-item:hover img {
                transform: none;
            }

            .gallery-item-overlay {
                opacity: 1;
                background: linear-gradient(to top, rgba(0,0,0,0.7), transparent 70%);
            }

            .action-btn {
                min-width: 44px;
                min-height: 44px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav" id="nav">
        <a href="#" class="nav-logo">MilesToMemories</a>
        <ul class="nav-links">
            <li><a href="#stories">Stories</a></li>
            <li><a href="#map">Map</a></li>
            <li><a href="#gallery">Gallery</a></li>
            <li><a href="#destinations">Destinations</a></li>
            <li id="navAddTrip" style="display:none"><a href="add-trip.html">Add Trip</a></li>
            <li id="navProfile" style="display:none"><a href="profile.html">Profile</a></li>
            <li id="navLogin"><a href="login.html">Login</a></li>
            <li id="navSignout" style="display:none"><a href="#" onclick="logout()">Sign Out</a></li>
        </ul>
        <button class="nav-toggle" id="navToggle"><span></span><span></span><span></span></button>
    </nav>

    
    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <button class="mobile-menu-close" id="mobileMenuClose">&times;</button>
        <div class="mobile-menu-user" id="mobileMenuUser" style="display:none">
            <img id="mobileUserAvatar" src="" alt="Profile" class="mobile-user-avatar">
            <div class="mobile-user-name" id="mobileUserName">User</div>
        </div>
        <a href="#stories" class="mobile-menu-link">Stories</a>
        <a href="#map" class="mobile-menu-link">Map</a>
        <a href="#gallery" class="mobile-menu-link">Gallery</a>
        <a href="#destinations" class="mobile-menu-link">Destinations</a>
        <a href="add-trip.html" class="mobile-menu-link owner-only" style="display:none">Add Trip</a>
        <a href="profile.html" class="mobile-menu-link owner-only" style="display:none">My Profile</a>
        <a href="login.html" class="mobile-menu-link guest-only" id="mobileLoginLink">Sign In</a>
        <a href="#" class="mobile-menu-link mobile-signout owner-only" style="display:none" onclick="logout()">Sign Out</a>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="bottom-nav-item active">
            <span class="bottom-nav-icon">&#127968;</span><span>Home</span>
        </a>
        <a href="#stories" class="bottom-nav-item">
            <span class="bottom-nav-icon">&#128218;</span><span>Stories</span>
        </a>
        <a href="add-trip.html" class="bottom-nav-item bottom-nav-add owner-only" id="bottomNavAdd" style="display:none"><span>+</span></a>
        <a href="login.html" class="bottom-nav-item bottom-nav-add guest-only" id="bottomNavLogin"><span>&#128100;</span></a>
        <a href="#gallery" class="bottom-nav-item">
            <span class="bottom-nav-icon">&#127748;</span><span>Gallery</span>
        </a>
        <a href="#" class="bottom-nav-item" id="bottomNavProfile" onclick="toggleMobileProfile()">
            <span class="bottom-nav-icon" id="bottomNavProfileIcon">&#128100;</span><span id="bottomNavProfileText">Login</span>
        </a>
    </nav>

    <!-- Hero -->
    <section class="hero">
        <div class="hero-bg">
            <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1200&q=80" alt="Mountain landscape">
            <div class="hero-overlay"></div>
        </div>
        <div class="hero-content">
            <p class="hero-subtitle">A Travel Diary</p>
            <h1>MilesToMemories</h1>
            <p class="hero-description">"The world is a book, and those who do not travel read only one page."</p>
        </div>
        <div class="scroll-indicator">
            <span>Scroll</span>
            <div class="arrow"></div>
        </div>
    </section>

    <!-- Introduction -->
    <section class="section intro fade-in">
        <h2>Stories from the Road</h2>
        <p>Welcome to my travel diaryâ€”a collection of moments captured across continents, through misty mountain passes and winding streets of ancient cities.</p>
        <div class="intro-divider"></div>
        <p>This is not just about destinations. It's about the conversations with strangers who became friends.</p>
    </section>

    <!-- Stories -->
    <section class="section stories" id="stories">
        <div class="section-header">
            <p class="section-label">Recent Adventures</p>
            <h2>Latest Stories</h2>
        </div>
        <div class="stories-grid" id="storiesGrid"></div>
    </section>

    <!-- Featured Story - Dynamic -->
    <section class="featured" id="featuredSection" style="display: none;">
        <div class="featured-container" id="featuredContainer">
            <!-- Rendered dynamically -->
        </div>
    </section>

    <!-- Map Timeline -->
    <section class="map-timeline-section" id="map">
        <div class="section-header fade-in">
            <p class="section-label">Journey Tracker</p>
            <h2>My Travel Map</h2>
        </div>
        <div class="map-timeline-container">
            <div class="map-container">
                <div id="tripMap"></div>
            </div>
            <div class="timeline-container">
                <div class="timeline-header">
                    <span class="timeline-title">Timeline</span>
                    <div class="timeline-filter">
                        <button class="timeline-filter-btn active" onclick="filterTimeline('all')">All</button>
                        <button class="timeline-filter-btn" onclick="filterTimeline('2024')">2024</button>
                        <button class="timeline-filter-btn" onclick="filterTimeline('2023')">2023</button>
                    </div>
                </div>
                <div class="timeline-scroll" id="timelineScroll"></div>
            </div>
        </div>
    </section>

    <!-- Gallery - Dynamic -->
    <section class="section" id="gallery" style="display: none;">
        <div class="section-header fade-in">
            <p class="section-label">Visual Journal</p>
            <h2>Captured Moments</h2>
        </div>
        <div class="gallery-grid" id="galleryGrid">
            <!-- Rendered dynamically -->
        </div>
    </section>

    <!-- Quote -->
    <section class="section quote-section">
        <div class="quote fade-in">
            <blockquote>"Travel is the only thing you buy that makes you richer."</blockquote>
            <cite>â€” From the Journal</cite>
        </div>
    </section>

    <!-- Destinations -->
    <section class="section" id="destinations">
        <div class="section-header fade-in">
            <p class="section-label">Explore By</p>
            <h2>Destinations</h2>
        </div>
        <div class="destinations-list" id="destinationsList"></div>
    </section>

    <!-- Newsletter -->
    <section class="section newsletter">
        <div class="newsletter-content fade-in">
            <h2>Join the Journey</h2>
            <p>Receive new stories and travel inspiration in your inbox.</p>
            <form class="newsletter-form" id="newsletterForm">
                <input type="email" class="newsletter-input" placeholder="Your email address" required>
                <button type="submit" class="newsletter-btn">Subscribe</button>
            </form>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-brand">
                <h3>MilesToMemories</h3>
                <p>A personal travel diary documenting journeys across the globe.</p>
            </div>
            <div class="footer-links-grid">
                <div class="footer-links">
                    <h4>Explore</h4>
                    <ul>
                        <li><a href="#">All Stories</a></li>
                        <li><a href="#">Photo Gallery</a></li>
                        <li><a href="#">Destinations</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Connect</h4>
                    <div class="footer-social-icons" id="footerSocialLinks">
                        <a href="profile.html" class="footer-connect-prompt">Link your social accounts in Profile</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 MilesToMemories. Made with love from the road.</p>
        </div>
    </footer>

    <!-- Trip Detail Modal -->
    <div class="modal-overlay" id="tripModal">
        <div class="trip-modal">
            <div class="modal-handle"></div>
            <div class="modal-header">
                <span class="modal-title" id="modalTitle">Trip Details</span>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="trip-image-container">
                    <img id="tripImage" class="trip-image" src="" alt="Trip">
                    <div class="trip-gallery-dots" id="galleryDots"></div>
                </div>
                <div class="trip-actions">
                    <div class="trip-actions-left">
                        <button class="action-btn" id="likeBtn" onclick="toggleLike()">&#9825;</button>
                        <button class="action-btn" onclick="focusComment()">&#128172;</button>
                        <button class="action-btn" onclick="shareTrip()">&#10148;</button>
                    </div>
                    <div class="trip-actions-right">
                        <button class="action-btn owner-only" id="editBtn" onclick="openEditModal()" style="display:none" title="Edit">&#9998;</button>
                        <button class="action-btn" id="saveBtn" onclick="toggleSave()">&#9734;</button>
                    </div>
                </div>
                <div class="trip-info">
                    <div class="trip-likes" id="tripLikes">0 likes</div>
                    <div class="trip-location" id="tripLocation">&#128205; Location</div>
                    <div class="trip-date" id="tripDate">Date</div>
                    <p class="trip-description" id="tripDescription">Description</p>
                    <div class="trip-mood" id="tripMood">&#128578; Peaceful</div>
                </div>
                <div class="comments-section">
                    <div class="comments-header" id="commentsHeader">Comments (0)</div>
                    <div id="commentsList"></div>
                </div>
                <div class="add-comment">
                    <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop" class="add-comment-avatar" alt="You">
                    <input type="text" class="add-comment-input" id="commentInput" placeholder="Add a comment..." oninput="toggleCommentBtn()">
                    <button class="add-comment-btn" id="commentBtn" onclick="addComment()">Post</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Trip Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="edit-modal">
            <div class="modal-handle"></div>
            <div class="modal-header">
                <span class="modal-title">Edit Trip</span>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <form class="edit-form" id="editForm" onsubmit="saveEdit(event)">
                <div class="edit-photo-preview">
                    <img id="editPhotoPreview" src="" alt="Trip photo">
                    <button type="button" class="edit-photo-btn" onclick="document.getElementById('editPhotoInput').click()">
                        &#128247; Change Photo
                    </button>
                    <input type="file" id="editPhotoInput" accept="image/*" hidden onchange="previewEditPhoto(this)">
                </div>

                <div>
                    <div class="edit-label">Title</div>
                    <input type="text" class="edit-input" id="editTitle" required>
                </div>

                <div>
                    <div class="edit-label">Location</div>
                    <input type="text" class="edit-input" id="editLocation" required>
                </div>

                <div>
                    <div class="edit-label">Date</div>
                    <input type="text" class="edit-input" id="editDate" placeholder="e.g., November 2024">
                </div>

                <div>
                    <div class="edit-label">Description</div>
                    <textarea class="edit-input edit-textarea" id="editDescription"></textarea>
                </div>

                <div>
                    <div class="edit-label">Mood</div>
                    <select class="edit-input" id="editMood">
                        <option value="peaceful">&#128578; Peaceful</option>
                        <option value="relaxed">&#128524; Relaxed</option>
                        <option value="adventurous">&#129302; Adventurous</option>
                        <option value="excited">&#128525; Excited</option>
                        <option value="nostalgic">&#128173; Nostalgic</option>
                    </select>
                </div>
            </form>
            <div class="edit-actions">
                <button class="edit-btn edit-btn-delete" onclick="deleteTrip()">Delete</button>
                <button class="edit-btn edit-btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="edit-btn edit-btn-save" onclick="saveEdit(event)">Save</button>
            </div>
        </div>
    </div>

    <!-- Destination Modal -->
    <div class="modal-overlay" id="destinationModal">
        <div class="destination-modal">
            <div class="destination-header">
                <button class="destination-back" onclick="closeDestinationModal()">&#8592;</button>
                <div class="destination-title">
                    <h2 id="destModalTitle">Japan</h2>
                    <div class="destination-count" id="destModalCount">3 trips</div>
                </div>
            </div>
            <div class="destination-body">
                <div class="destination-hero" id="destHero">
                    <img id="destHeroImage" src="" alt="Destination">
                    <div class="destination-hero-overlay">
                        <div class="destination-hero-title" id="destHeroTitle">Explore Japan</div>
                        <div class="destination-hero-subtitle" id="destHeroSubtitle">Land of the Rising Sun</div>
                    </div>
                </div>
                <div class="destination-section-title">All Trips</div>
                <div class="destination-grid" id="destGrid"></div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script src="api.js"></script>
    <script>
        // Authentication
        let currentUser = null;

        function checkAuth() {
            const userStr = localStorage.getItem('user');
            if (userStr) {
                currentUser = JSON.parse(userStr);
                showOwnerUI();
            } else {
                currentUser = null;
                showGuestUI();
            }
        }

        function showOwnerUI() {
            // Desktop nav
            document.getElementById('navAddTrip').style.display = 'block';
            document.getElementById('navProfile').style.display = 'block';
            document.getElementById('navLogin').style.display = 'none';
            document.getElementById('navSignout').style.display = 'block';

            // Mobile menu
            document.getElementById('mobileMenuUser').style.display = 'flex';
            document.getElementById('mobileUserAvatar').src = currentUser.avatar;
            document.getElementById('mobileUserName').textContent = currentUser.name;
            document.querySelectorAll('.owner-only').forEach(el => el.style.display = '');
            document.querySelectorAll('.guest-only').forEach(el => el.style.display = 'none');

            // Bottom nav
            document.getElementById('bottomNavAdd').style.display = '';
            document.getElementById('bottomNavLogin').style.display = 'none';
            document.getElementById('bottomNavProfileText').textContent = 'Profile';

            // Edit button in trip modal
            document.getElementById('editBtn').style.display = '';

            // Update footer social links
            updateFooterSocialLinks();
        }

        function updateFooterSocialLinks() {
            const connections = JSON.parse(localStorage.getItem('socialConnections') || '{}');
            const footerLinks = document.getElementById('footerSocialLinks');

            let html = '';
            let hasConnections = false;

            if (connections.instagram) {
                html += `<a href="https://instagram.com/${connections.instagram}" target="_blank" rel="noopener" class="footer-social-icon instagram" title="@${connections.instagram}">
                    <svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                </a>`;
                hasConnections = true;
            }
            if (connections.pinterest) {
                html += `<a href="https://pinterest.com/${connections.pinterest}" target="_blank" rel="noopener" class="footer-social-icon pinterest" title="@${connections.pinterest}">
                    <svg viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.372-12 12 0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738.098.119.112.224.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.631-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146 1.124.347 2.317.535 3.554.535 6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z"/></svg>
                </a>`;
                hasConnections = true;
            }
            if (connections.youtube) {
                html += `<a href="https://youtube.com/@${connections.youtube}" target="_blank" rel="noopener" class="footer-social-icon youtube" title="@${connections.youtube}">
                    <svg viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
                </a>`;
                hasConnections = true;
            }

            if (!hasConnections) {
                html = '<a href="profile.html" class="footer-connect-prompt">Link your social accounts in Profile</a>';
            }

            footerLinks.innerHTML = html;
        }

        function showGuestUI() {
            // Desktop nav
            document.getElementById('navAddTrip').style.display = 'none';
            document.getElementById('navProfile').style.display = 'none';
            document.getElementById('navLogin').style.display = 'block';
            document.getElementById('navSignout').style.display = 'none';

            // Mobile menu
            document.getElementById('mobileMenuUser').style.display = 'none';
            document.getElementById('mobileLoginLink').style.display = '';
            document.querySelectorAll('.owner-only').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.guest-only').forEach(el => el.style.display = '');

            // Bottom nav
            document.getElementById('bottomNavAdd').style.display = 'none';
            document.getElementById('bottomNavLogin').style.display = '';
            document.getElementById('bottomNavProfileText').textContent = 'Login';

            // Edit button in trip modal
            document.getElementById('editBtn').style.display = 'none';

            // Reset footer social links
            document.getElementById('footerSocialLinks').innerHTML = '<a href="profile.html" class="footer-connect-prompt">Link your social accounts in Profile</a>';
        }

        function toggleMobileProfile() {
            if (currentUser) {
                window.location.href = 'profile.html';
            } else {
                window.location.href = 'login.html';
            }
        }

        function logout() {
            localStorage.removeItem('user');
            showToast('Signed out successfully');
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }

        // Destination Data
        const destinations = {
            'Japan': {
                hero: 'https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=1000&q=80',
                subtitle: 'Land of the Rising Sun',
                keywords: ['Japan', 'Kyoto', 'Tokyo', 'Osaka']
            },
            'Italy': {
                hero: 'https://images.unsplash.com/photo-1516483638261-f4dbaf036963?w=1000&q=80',
                subtitle: 'La Dolce Vita',
                keywords: ['Italy', 'Amalfi', 'Rome', 'Venice', 'Florence']
            },
            'Iceland': {
                hero: 'https://images.unsplash.com/photo-1504893524553-b855bce32c67?w=1000&q=80',
                subtitle: 'Land of Fire and Ice',
                keywords: ['Iceland', 'Reykjavik']
            },
            'Switzerland': {
                hero: 'https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1000&q=80',
                subtitle: 'Alpine Paradise',
                keywords: ['Switzerland', 'Swiss Alps', 'Zurich', 'Geneva']
            },
            'Morocco': {
                hero: 'https://images.unsplash.com/photo-1518548419970-58e3b4079ab2?w=1000&q=80',
                subtitle: 'Colors of the Medina',
                keywords: ['Morocco', 'Marrakech', 'Fes']
            },
            'Slovenia': {
                hero: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=1000&q=80',
                subtitle: 'Hidden Gem of Europe',
                keywords: ['Slovenia', 'Lake Bled', 'Ljubljana']
            },
            'Costa Rica': {
                hero: 'https://images.unsplash.com/photo-1433086966358-54859d0ed716?w=1000&q=80',
                subtitle: 'Pura Vida',
                keywords: ['Costa Rica']
            },
            'Norway': {
                hero: 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=1000&q=80',
                subtitle: 'Land of Fjords',
                keywords: ['Norway', 'Norwegian', 'Oslo', 'Bergen']
            },
            'USA': {
                hero: 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=1000&q=80',
                subtitle: 'From Coast to Coast',
                keywords: ['USA', 'Pacific Northwest', 'California', 'New York']
            }
        };

        // Trip Data - loaded from API
        let trips = [];

        // Load trips from API - only user's own trips
        async function loadTripsFromAPI() {
            try {
                const token = localStorage.getItem('token');

                // If not logged in, show empty state
                if (!token) {
                    trips = [];
                    renderStories();
                    renderFeaturedStory();
                    renderGallery();
                    renderDestinations();
                    return;
                }

                // Fetch only the logged-in user's trips
                const response = await fetch(API_BASE + '/users/trips', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });

                if (!response.ok) {
                    trips = [];
                    renderStories();
                    renderFeaturedStory();
                    renderGallery();
                    renderDestinations();
                    return;
                }

                const data = await response.json();

                // Transform API data to match frontend format
                trips = data.map(trip => ({
                    id: trip.id,
                    title: trip.title,
                    location: trip.location,
                    date: trip.date || '',
                    image: trip.image_url,
                    description: trip.description || '',
                    mood: trip.mood || 'peaceful',
                    likes: parseInt(trip.likes_count) || 0,
                    liked: trip.liked || false,
                    saved: trip.saved || false,
                    comments: [],
                    latitude: trip.latitude,
                    longitude: trip.longitude,
                    user_id: trip.user_id
                }));

                // Re-render everything with new data
                renderStories();
                renderFeaturedStory();
                renderGallery();
                renderDestinations();
                // Update map markers if map is already initialized
                if (map) {
                    addTripMarkers();
                    renderTimeline();
                }
            } catch (error) {
                console.error('Failed to load trips:', error);
                // Show empty state if API fails
                trips = [];
                renderStories();
                renderFeaturedStory();
                renderGallery();
                renderDestinations();
            }
        }

        let currentTrip = null;

        const moodEmojis = {
            peaceful: '&#128578;',
            relaxed: '&#128524;',
            adventurous: '&#129302;',
            excited: '&#128525;',
            nostalgic: '&#128173;'
        };

        // Render Story Cards
        function renderStories() {
            const grid = document.getElementById('storiesGrid');
            grid.innerHTML = trips.slice(0, 3).map((trip, index) => `
                <article class="story-card" onclick="openTripModal(${trip.id})">
                    <div class="story-card-image">
                        <img src="${trip.image}" alt="${trip.title}">
                    </div>
                    <div class="story-card-content">
                        <p class="story-card-location">${trip.location}</p>
                        <h3>${trip.title}</h3>
                        <div class="story-card-meta">
                            <span class="story-card-date">${trip.date}</span>
                            <div class="story-card-stats">
                                <span>&#9825; ${trip.likes}</span>
                                <span>&#128172; ${trip.comments.length}</span>
                            </div>
                        </div>
                    </div>
                </article>
            `).join('');

            // Animate cards
            setTimeout(() => {
                document.querySelectorAll('.story-card').forEach((card, i) => {
                    setTimeout(() => card.classList.add('visible'), i * 100);
                });
            }, 300);
        }

        // Render Featured Story - shows most liked trip
        function renderFeaturedStory() {
            const section = document.getElementById('featuredSection');
            const container = document.getElementById('featuredContainer');

            if (trips.length === 0) {
                section.style.display = 'none';
                return;
            }

            // Get the trip with most likes (or first trip if no likes)
            const featuredTrip = trips.reduce((max, trip) => trip.likes > max.likes ? trip : max, trips[0]);

            section.style.display = 'block';
            container.innerHTML = `
                <div class="featured-image" onclick="openTripModal(${featuredTrip.id})">
                    <img src="${featuredTrip.image}" alt="${featuredTrip.title}">
                </div>
                <div class="featured-content fade-in">
                    <p class="featured-label">Featured Story</p>
                    <h2>${featuredTrip.title}</h2>
                    <p class="featured-excerpt">${featuredTrip.description.substring(0, 150)}${featuredTrip.description.length > 150 ? '...' : ''}</p>
                    <span class="read-more" onclick="openTripModal(${featuredTrip.id})">Read the full story</span>
                </div>
            `;
        }

        // Render Gallery - shows all trips as gallery items
        function renderGallery() {
            const section = document.getElementById('gallery');
            const grid = document.getElementById('galleryGrid');

            if (trips.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            grid.innerHTML = trips.slice(0, 5).map(trip => `
                <div class="gallery-item" onclick="openTripModal(${trip.id})">
                    <img src="${trip.image}" alt="${trip.title}">
                    <div class="gallery-item-overlay">
                        <p class="gallery-item-caption">${trip.title}</p>
                    </div>
                </div>
            `).join('');
        }

        // Open Trip Modal
        function openTripModal(tripId) {
            currentTrip = trips.find(t => t.id === tripId);
            if (!currentTrip) return;

            document.getElementById('modalTitle').textContent = currentTrip.title;
            document.getElementById('tripImage').src = currentTrip.image;
            document.getElementById('tripLocation').innerHTML = `&#128205; ${currentTrip.location}`;
            document.getElementById('tripDate').textContent = currentTrip.date;
            document.getElementById('tripDescription').textContent = currentTrip.description;
            document.getElementById('tripLikes').textContent = `${currentTrip.likes.toLocaleString()} likes`;
            document.getElementById('tripMood').innerHTML = `${moodEmojis[currentTrip.mood]} ${currentTrip.mood.charAt(0).toUpperCase() + currentTrip.mood.slice(1)}`;

            updateLikeBtn();
            updateSaveBtn();
            renderComments();

            document.getElementById('tripModal').classList.add('active');
            document.body.classList.add('modal-open');
        }

        // Close Modal
        function closeModal() {
            document.getElementById('tripModal').classList.remove('active');
            document.body.classList.remove('modal-open');
        }

        // Like functionality
        function toggleLike() {
            if (!currentTrip) return;
            currentTrip.liked = !currentTrip.liked;
            currentTrip.likes += currentTrip.liked ? 1 : -1;
            updateLikeBtn();
            document.getElementById('tripLikes').textContent = `${currentTrip.likes.toLocaleString()} likes`;
            renderStories();
        }

        function updateLikeBtn() {
            const btn = document.getElementById('likeBtn');
            if (currentTrip.liked) {
                btn.innerHTML = '&#10084;';
                btn.classList.add('liked');
            } else {
                btn.innerHTML = '&#9825;';
                btn.classList.remove('liked');
            }
        }

        // Save functionality
        function toggleSave() {
            if (!currentTrip) return;
            currentTrip.saved = !currentTrip.saved;
            updateSaveBtn();
            showToast(currentTrip.saved ? 'Saved to collection' : 'Removed from collection');
        }

        function updateSaveBtn() {
            const btn = document.getElementById('saveBtn');
            if (currentTrip.saved) {
                btn.innerHTML = '&#9733;';
                btn.classList.add('saved');
            } else {
                btn.innerHTML = '&#9734;';
                btn.classList.remove('saved');
            }
        }

        // Comments
        function renderComments() {
            const list = document.getElementById('commentsList');
            document.getElementById('commentsHeader').textContent = `Comments (${currentTrip.comments.length})`;

            list.innerHTML = currentTrip.comments.map(comment => `
                <div class="comment">
                    <img src="${comment.avatar}" class="comment-avatar" alt="${comment.author}">
                    <div class="comment-content">
                        <div class="comment-author">${comment.author}</div>
                        <div class="comment-text">${comment.text}</div>
                        <div class="comment-time">${comment.time}</div>
                    </div>
                    <button class="comment-like">&#9825;</button>
                </div>
            `).join('');
        }

        function focusComment() {
            document.getElementById('commentInput').focus();
        }

        function toggleCommentBtn() {
            const input = document.getElementById('commentInput');
            const btn = document.getElementById('commentBtn');
            btn.classList.toggle('active', input.value.trim().length > 0);
        }

        function addComment() {
            const input = document.getElementById('commentInput');
            const text = input.value.trim();
            if (!text || !currentTrip) return;

            currentTrip.comments.push({
                author: 'You',
                text: text,
                time: 'Just now',
                avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop'
            });

            input.value = '';
            toggleCommentBtn();
            renderComments();
            renderStories();
            showToast('Comment added!');
        }

        // Share
        function shareTrip() {
            if (navigator.share) {
                navigator.share({
                    title: currentTrip.title,
                    text: `Check out this trip to ${currentTrip.location}!`,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showToast('Link copied to clipboard!');
            }
        }

        // Toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        // Navigation
        const nav = document.getElementById('nav');
        const navToggle = document.getElementById('navToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        const mobileMenuClose = document.getElementById('mobileMenuClose');

        navToggle.addEventListener('click', () => {
            mobileMenu.classList.add('active');
            document.body.style.overflow = 'hidden';
        });

        mobileMenuClose.addEventListener('click', () => {
            mobileMenu.classList.remove('active');
            document.body.style.overflow = '';
        });

        document.querySelectorAll('.mobile-menu-link').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
                document.body.style.overflow = '';
            });
        });

        // Close modal on overlay click
        document.getElementById('tripModal').addEventListener('click', (e) => {
            if (e.target.id === 'tripModal') closeModal();
        });

        // Bottom nav active state
        document.querySelectorAll('.bottom-nav-item:not(.bottom-nav-add)').forEach(item => {
            item.addEventListener('click', function() {
                if (this.getAttribute('href').startsWith('#')) {
                    document.querySelectorAll('.bottom-nav-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Intersection Observer
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));

        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                const href = this.getAttribute('href');
                if (href !== '#') {
                    e.preventDefault();
                    const target = document.querySelector(href);
                    if (target) {
                        window.scrollTo({
                            top: target.offsetTop - 80,
                            behavior: 'smooth'
                        });
                    }
                }
            });
        });

        // Newsletter
        document.getElementById('newsletterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = this.querySelector('.newsletter-btn');
            btn.textContent = 'Subscribed!';
            this.querySelector('.newsletter-input').value = '';
            setTimeout(() => btn.textContent = 'Subscribe', 3000);
        });

        // Render Destinations
        function renderDestinations() {
            const list = document.getElementById('destinationsList');
            const destNames = Object.keys(destinations);

            // Count trips per destination
            const counts = {};
            destNames.forEach(dest => {
                const keywords = destinations[dest].keywords;
                counts[dest] = trips.filter(trip =>
                    keywords.some(kw => trip.location.toLowerCase().includes(kw.toLowerCase()))
                ).length;
            });

            list.innerHTML = destNames.map(dest => `
                <button class="destination-tag" onclick="openDestinationModal('${dest}')">
                    ${dest} ${counts[dest] > 0 ? `<span style="opacity:0.6">(${counts[dest]})</span>` : ''}
                </button>
            `).join('');
        }

        // Open Destination Modal
        function openDestinationModal(destName) {
            const dest = destinations[destName];
            if (!dest) return;

            // Filter trips for this destination
            const destTrips = trips.filter(trip =>
                dest.keywords.some(kw => trip.location.toLowerCase().includes(kw.toLowerCase()))
            );

            // Update modal content
            document.getElementById('destModalTitle').textContent = destName;
            document.getElementById('destModalCount').textContent = `${destTrips.length} trip${destTrips.length !== 1 ? 's' : ''}`;
            document.getElementById('destHeroImage').src = dest.hero;
            document.getElementById('destHeroTitle').textContent = `Explore ${destName}`;
            document.getElementById('destHeroSubtitle').textContent = dest.subtitle;

            // Render trip grid
            const grid = document.getElementById('destGrid');
            if (destTrips.length > 0) {
                grid.innerHTML = destTrips.map(trip => `
                    <div class="destination-item" onclick="closeDestinationModal(); setTimeout(() => openTripModal(${trip.id}), 300)">
                        <img src="${trip.image}" alt="${trip.title}">
                        <div class="destination-item-overlay">
                            <div class="destination-item-title">${trip.title}</div>
                            <div class="destination-item-date">${trip.date}</div>
                            <div class="destination-item-stats">
                                <span>&#9825; ${trip.likes}</span>
                                <span>&#128172; ${trip.comments.length}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                grid.innerHTML = `
                    <div class="no-trips" style="grid-column: span 2;">
                        <div class="no-trips-icon">&#127757;</div>
                        <p>No trips to ${destName} yet.<br>Start exploring!</p>
                    </div>
                `;
            }

            // Show/hide hero based on trips
            document.getElementById('destHero').style.display = destTrips.length > 0 ? 'block' : 'none';

            document.getElementById('destinationModal').classList.add('active');
            document.body.classList.add('modal-open');
        }

        // Close Destination Modal
        function closeDestinationModal() {
            document.getElementById('destinationModal').classList.remove('active');
            document.body.classList.remove('modal-open');
        }

        // Close destination modal on overlay click
        document.getElementById('destinationModal').addEventListener('click', (e) => {
            if (e.target.id === 'destinationModal') closeDestinationModal();
        });

        // Edit Trip Functions
        let editingTripId = null;
        let newPhotoData = null;

        function openEditModal() {
            if (!currentUser || !currentTrip) return;

            editingTripId = currentTrip.id;
            newPhotoData = null;

            document.getElementById('editPhotoPreview').src = currentTrip.image;
            document.getElementById('editTitle').value = currentTrip.title;
            document.getElementById('editLocation').value = currentTrip.location;
            document.getElementById('editDate').value = currentTrip.date;
            document.getElementById('editDescription').value = currentTrip.description;
            document.getElementById('editMood').value = currentTrip.mood;

            closeModal();
            setTimeout(() => {
                document.getElementById('editModal').classList.add('active');
                document.body.classList.add('modal-open');
            }, 300);
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            document.body.classList.remove('modal-open');
            editingTripId = null;
            newPhotoData = null;
        }

        function previewEditPhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('editPhotoPreview').src = e.target.result;
                    newPhotoData = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function saveEdit(e) {
            e.preventDefault();
            if (editingTripId === null) return;

            const trip = trips.find(t => t.id === editingTripId);
            if (!trip) return;

            trip.title = document.getElementById('editTitle').value;
            trip.location = document.getElementById('editLocation').value;
            trip.date = document.getElementById('editDate').value;
            trip.description = document.getElementById('editDescription').value;
            trip.mood = document.getElementById('editMood').value;

            if (newPhotoData) {
                trip.image = newPhotoData;
            }

            // Save to localStorage
            saveTripsToStorage();

            closeEditModal();
            renderStories();
            renderDestinations();
            showToast('Trip updated successfully!');
        }

        function deleteTrip() {
            if (editingTripId === null) return;

            if (confirm('Are you sure you want to delete this trip? This cannot be undone.')) {
                const index = trips.findIndex(t => t.id === editingTripId);
                if (index > -1) {
                    trips.splice(index, 1);
                    saveTripsToStorage();
                    closeEditModal();
                    renderStories();
                    renderDestinations();
                    showToast('Trip deleted');
                }
            }
        }

        function saveTripsToStorage() {
            localStorage.setItem('userTrips', JSON.stringify(trips));
        }

        function loadTripsFromStorage() {
            const savedTrips = localStorage.getItem('userTrips');
            if (savedTrips) {
                const parsed = JSON.parse(savedTrips);
                parsed.forEach(savedTrip => {
                    const existing = trips.find(t => t.id === savedTrip.id);
                    if (existing) {
                        // Update existing trip
                        Object.assign(existing, savedTrip);
                    } else {
                        // Add new user-created trip
                        trips.unshift(savedTrip);
                    }
                });
            }
        }

        // Close edit modal on overlay click
        document.getElementById('editModal').addEventListener('click', (e) => {
            if (e.target.id === 'editModal') closeEditModal();
        });

        // Trip coordinates for map
        const tripCoordinates = {
            'Kyoto, Japan': { lat: 35.0116, lng: 135.7681 },
            'Amalfi Coast, Italy': { lat: 40.6333, lng: 14.6029 },
            'Swiss Alps': { lat: 46.8182, lng: 8.2275 },
            'Iceland': { lat: 64.9631, lng: -19.0208 },
            'Lake Bled, Slovenia': { lat: 46.3625, lng: 14.0936 },
            'Marrakech, Morocco': { lat: 31.6295, lng: -7.9811 },
            'Costa Rica': { lat: 9.7489, lng: -83.7534 },
            'Norway': { lat: 60.4720, lng: 8.4689 },
            'Pacific Northwest, USA': { lat: 47.6062, lng: -122.3321 }
        };

        let map = null;
        let markers = [];
        let currentFilter = 'all';

        function initMap() {
            // Initialize map centered on world view
            map = L.map('tripMap', {
                scrollWheelZoom: false
            }).setView([30, 0], 2);

            // Add tile layer with a nice style
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);

            // Add markers for each trip
            addTripMarkers();
            renderTimeline();
        }

        function addTripMarkers() {
            // Clear existing markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            const filteredTrips = getFilteredTrips();
            const bounds = [];

            filteredTrips.forEach((trip, index) => {
                const coords = getCoordinates(trip.location);
                if (coords) {
                    const customIcon = L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="background: var(--forest-green); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); border: 3px solid white;">${index + 1}</div>`,
                        iconSize: [30, 30],
                        iconAnchor: [15, 15]
                    });

                    const marker = L.marker([coords.lat, coords.lng], { icon: customIcon })
                        .addTo(map)
                        .bindPopup(`
                            <div class="map-marker-popup">
                                <img src="${trip.image}" alt="${trip.title}">
                                <h4>${trip.title}</h4>
                                <p>${trip.location}</p>
                                <p>${trip.date}</p>
                            </div>
                        `);

                    marker.on('click', () => {
                        highlightTimelineItem(trip.id);
                    });

                    markers.push(marker);
                    bounds.push([coords.lat, coords.lng]);
                }
            });

            // Fit map to show all markers
            if (bounds.length > 0) {
                map.fitBounds(bounds, { padding: [50, 50] });
            }
        }

        function getCoordinates(location) {
            // Check exact match first
            if (tripCoordinates[location]) {
                return tripCoordinates[location];
            }
            // Check partial match
            for (const key in tripCoordinates) {
                if (location.includes(key) || key.includes(location.split(',')[0])) {
                    return tripCoordinates[key];
                }
            }
            return null;
        }

        function getFilteredTrips() {
            if (currentFilter === 'all') {
                return trips;
            }
            return trips.filter(trip => trip.date.includes(currentFilter));
        }

        function renderTimeline() {
            const container = document.getElementById('timelineScroll');
            const filteredTrips = getFilteredTrips();

            if (filteredTrips.length === 0) {
                container.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #888;">
                        <p>No trips yet</p>
                        <p style="font-size: 0.9em;">Add your first trip to see it on the map!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredTrips.map(trip => `
                <div class="timeline-item" data-id="${trip.id}" onclick="selectTimelineItem(${trip.id})">
                    <div class="timeline-image">
                        <img src="${trip.image}" alt="${trip.title}">
                    </div>
                    <div class="timeline-info">
                        <div class="timeline-date">${trip.date}</div>
                        <div class="timeline-location">${trip.location}</div>
                        <div class="timeline-title-small">${trip.title}</div>
                    </div>
                </div>
            `).join('');
        }

        function filterTimeline(filter) {
            currentFilter = filter;

            // Update button states
            document.querySelectorAll('.timeline-filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(filter.toLowerCase()) ||
                    (filter === 'all' && btn.textContent === 'All')) {
                    btn.classList.add('active');
                }
            });

            addTripMarkers();
            renderTimeline();
        }

        function selectTimelineItem(tripId) {
            const trip = trips.find(t => t.id === tripId);
            if (!trip) return;

            // Highlight timeline item
            highlightTimelineItem(tripId);

            // Pan to marker and open popup
            const coords = getCoordinates(trip.location);
            if (coords) {
                map.setView([coords.lat, coords.lng], 6);
                const markerIndex = getFilteredTrips().findIndex(t => t.id === tripId);
                if (markers[markerIndex]) {
                    markers[markerIndex].openPopup();
                }
            }

            // Open trip modal
            openTripModal(tripId);
        }

        function highlightTimelineItem(tripId) {
            document.querySelectorAll('.timeline-item').forEach(item => {
                item.classList.remove('active');
                if (parseInt(item.dataset.id) === tripId) {
                    item.classList.add('active');
                    item.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            });
        }

        // Initialize
        checkAuth();
        loadTripsFromAPI(); // Load trips from database API

        // Initialize map after DOM is ready
        setTimeout(initMap, 100);
    </script>
</body>
</html>
